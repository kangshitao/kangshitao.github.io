

<!DOCTYPE html>
<html lang="zh-CN" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>JDBC与Druid数据库连接池 - Live And Learn</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  <meta name="keywords" content="hexo-blog,live and learn,kangshitao, 数据库,MySQL,JDBC,数据库连接池,Druid,DBUtils">
  <meta name="description" content="一、传统数据库连接1、JDBC简介JDBC(Java ...">
  <meta name="author" content="Kangshitao">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/atelier-heath-light.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/monokai-sublime.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '[object Object]'
      },
      donate: {
        enable: true,
        alipay: 'https://cdn.jsdelivr.net/gh/kangshitao/BlogPicture@main/img/alipay.jpg',
        wechat: 'https://cdn.jsdelivr.net/gh/kangshitao/BlogPicture@main/img/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '心之所向，素履以往',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: '',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'normal'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: true,
        path: '/search.xml'
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Live And Learn" type="application/atom+xml">
</head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
        <i class="iconfont iconqrcode j-navbar-qrcode"></i>
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
        <i class="iconfont iconsearch j-navbar-search"></i>
      
    </div>
    <div class="center">JDBC与Druid数据库连接池</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
      <div id="qrcode-navbar"></div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/archives " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/about " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="https://cdn.jsdelivr.net/gh/kangshitao/BlogPicture@main/img/post_image_4.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">JDBC与Druid数据库连接池</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>四月 30, 2021</span>
      
        <span class="post-info-item">
          <i class="iconfont iconeye"></i><span id="/2021/04/30/jdbc-datasource/" class="leancloud" data-flag-title="JDBC与Druid数据库连接池"></span>
        </span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>26830</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <h1 id="一、传统数据库连接"><a href="#一、传统数据库连接" class="headerlink" title="一、传统数据库连接"></a>一、传统数据库连接</h1><h2 id="1、JDBC简介"><a href="#1、JDBC简介" class="headerlink" title="1、JDBC简介"></a>1、JDBC简介</h2><p><strong>JDBC</strong>(Java Database Connectivity)是<strong>独立于特定数据库管理系统、通用的SQL数据库存取和操作的公共接口</strong>（一组API），定义了用来访问数据库的标准Java类库（<strong>java.sql,javax.sql</strong>），使用这些类库可以以一种<strong>标准</strong>的方法、方便地访问数据库资源。</p>
<p>开发人员只需要<strong>面向JDBC的接口编程</strong>即可，不同数据库厂商各自需要实现JDBC接口，即为不同的数据库驱动。</p>
<p>使用JDBC连接并操作数据库的步骤：</p>
<ul>
<li>导入<code>java.sql</code>和所使用的数据库的驱动，即<code>.jar</code>包</li>
<li>加载并注册驱动程序</li>
<li>创建<code>Connection</code>对象，建立连接</li>
<li>创建<code>Statement</code>或<code>PreparedStatement</code>对象</li>
<li>执行SQL语句，实现CRUD操作，如果是查询操作，会返回结果集<code>ResultSet</code>并需要处理。</li>
<li>关闭<code>Statement</code>/<code>PreparedStatement</code>对象和<code>Connection</code>连接，如果有<code>ResultSet</code>，也需要关闭。</li>
</ul>
<h2 id="2、数据库连接"><a href="#2、数据库连接" class="headerlink" title="2、数据库连接"></a>2、数据库连接</h2><p><code>java.sql.Driver</code>接口是所有JDBC驱动程序需要实现的接口，数据库厂商需要实现此接口。程序中使用驱动程序管理器类(<code>java.sql.DriverManager</code>)调用这些<code>Driver</code>实现（即注册驱动）。</p>
<p>创建连接的步骤：</p>
<ul>
<li><p><strong>加载并读取配置相关信息</strong>，如数据库用户名，密码，驱动的类名，驱动URL</p>
</li>
<li><p><strong>加载驱动</strong>，即实例化Driver，一般不主动实例化，而是使用反射的方式，根据加载的JDBC驱动的类名，加载驱动。如<code>Class.forName(“com.mysql.jdbc.Driver”);</code></p>
</li>
<li><p><strong>注册驱动</strong>:</p>
<ul>
<li><p>方式一，使用<code>DriverManager.registerDriver(com.mysql.jdbc.Driver)</code>注册驱动.</p>
</li>
<li><p>方式二，通常不手动注册，因为 <code>Driver</code>接口的驱动程序类<strong>都</strong>包含了静态代码块，在这个静态代码块中，会调用 <code>DriverManager.registerDriver()</code>方法来注册自身的一个实例。比如MySQL的<code>Driver</code>实现类的源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        java.sql.DriverManager.registerDriver(<span class="hljs-keyword">new</span> Driver());<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException E) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Can&#x27;t register driver!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>获取连接</strong>。调用<code>DriverManager</code> 类的静态 <code>getConnection()</code> 方法建立到数据库的连接。</li>
</ul>
<blockquote>
<p>url用于标识一个被注册的驱动程序，驱动程序管理器通过这个 URL 选择正确的驱动程序，从而建立到数据库的连接。JDBC URL由三部分组成，即<code>jdbc:子协议:子名称</code>，子名称用于定位具体的数据库，包含主机名、端口号、数据库名。比如对于MySQL来说，其URL编写格式为：jdbc:mysql://[主机名称:mysql的服务端口号]/数据库名称[?参数=值&amp;参数=值]，例如test数据库，可以写为：<code>jdbc:mysql://localhost:3306/test?characterEncoding=utf-8</code>，如果有编码问题，可以设置连接时的参数。</p>
</blockquote>
<p>使用<code>DriverManager</code> 获取数据库连接举例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title">testConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//1.加载配置文件</span><br>    InputStream is = ConnectionTest.class.getClassLoader().<br>        getResourceAsStream(<span class="hljs-string">&quot;jdbc.properties&quot;</span>);<br>    roperties pros = <span class="hljs-keyword">new</span> Properties();<br>    pros.load(is);<br>    <br>    <span class="hljs-comment">//2.读取配置信息</span><br>    String user = pros.getProperty(<span class="hljs-string">&quot;user&quot;</span>);<br>    String password = pros.getProperty(<span class="hljs-string">&quot;password&quot;</span>);<br>    String url = pros.getProperty(<span class="hljs-string">&quot;url&quot;</span>);<br>    String driverClass = pros.getProperty(<span class="hljs-string">&quot;driverClass&quot;</span>);<br><br>    <span class="hljs-comment">//3.加载驱动(包含了实例化Driver和注册驱动两步)</span><br>    Class.forName(driverClass);<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    上述步骤通过反射获取Driver实现类的Class实例，目的是在此过程中调用</span><br><span class="hljs-comment">    对应实现类的静态代码块，代码块中实例化Driver，并注册了驱动</span><br><span class="hljs-comment">    */</span><br><br>    <span class="hljs-comment">//4.获取连接</span><br>    Connection conn = DriverManager.getConnection(url,user,password);<br>    System.out.println(conn);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>其中<code>jdbc.properties</code>配置文件需要在src目录下，内容如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">user</span>=<span class="hljs-string">root </span><br><span class="hljs-attr">password</span>=<span class="hljs-string">abc123</span><br><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/test?characterEncoding=utf-8</span><br><span class="hljs-attr">driverClass</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br></code></pre></td></tr></table></figure>
<p>这里操作符两边不能用空格。</p>
<h1 id="二、使用PreparedStatement实现CRUD操作"><a href="#二、使用PreparedStatement实现CRUD操作" class="headerlink" title="二、使用PreparedStatement实现CRUD操作"></a>二、使用PreparedStatement实现CRUD操作</h1><p>在<code>java.sql</code> 包中有 3 个接口分别定义了对数据库的调用的不同方式：</p>
<ul>
<li><code>Statement</code>：用于执行静态 SQL 语句并返回它所生成结果的对象。 </li>
<li><code>PrepatedStatement</code>：SQL 语句被预编译并存储在此对象中，可以使用此对象多次高效地执行该语句。</li>
<li><code>CallableStatement</code>：用于执行 SQL 存储过程</li>
</ul>
<h2 id="1、PreparedStatement介绍"><a href="#1、PreparedStatement介绍" class="headerlink" title="1、PreparedStatement介绍"></a>1、PreparedStatement介绍</h2><ul>
<li><p>可以通过调用 Connection 对象的 <strong>preparedStatement(String sql)</strong> 方法获取 PreparedStatement 对象</p>
</li>
<li><p><strong>PreparedStatement 接口是 Statement 的子接口，它表示一条预编译过的 SQL 语句</strong></p>
</li>
<li><p>PreparedStatement 对象所代表的 SQL 语句中的参数用<code>?</code>来表示，调用 PreparedStatement 对象的 <code>setXxx()</code> 方法来设置这些参数，<code>setXxx()</code> 方法有两个参数，第一个参数是要设置的 SQL 语句中的参数的索引(从<code>1</code>开始)，第二个是设置的 SQL 语句中的参数的值。</p>
</li>
</ul>
<h2 id="2、PreparedStatement的使用"><a href="#2、PreparedStatement的使用" class="headerlink" title="2、PreparedStatement的使用"></a>2、PreparedStatement的使用</h2><p><strong>PreparedStatement 和 Statement对比</strong>：</p>
<ul>
<li>PreparedStatement是Statement的子类，二者都能实现对数据库的CRUD操作</li>
<li>Statement使用字符串拼接操作，繁琐。而使用PreparedStatement的代码可读性和可维护性强。</li>
<li><strong>PreparedStatement 对SQL语句预编译</strong>，能最大可能提高性能：<ul>
<li>DBServer会对<strong>预编译</strong>语句提供性能优化。因为<strong>预编译语句有可能被重复调用</strong>，所以语句在被DBServer的编译器编译后的执行代码被缓存下来，那么下次调用时只要是相同的预编译语句就不需要编译，只要将参数直接传入编译过的语句执行代码中就会得到执行。</li>
<li>statement语句中，即使是相同操作，但因为数据内容不一样导致整个语句本身不能匹配，没有缓存语句的意义。事实是没有数据库会对普通语句编译后的执行代码缓存。这样每执行一次都要对传入的语句编译一次，效率降低。</li>
</ul>
</li>
<li>Statement存在SQL注入问题，PreparedStatement 使用预编译和<code>?</code>占位符传值，可以防止此问题 。</li>
<li>此外，PreparedStatement还能够实现对<code>Blob</code>数据的操作，并且对于批量插入比较高效。</li>
</ul>
<p>举例1：使用PreparedStatement实现增、删、改操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">我们将上述提到的数据库连接操作，以及资源关闭操作，封装到JDBCUtils工具类中，</span><br><span class="hljs-comment">即以下的几个静态方法：</span><br><span class="hljs-comment">public static Connection getConnection()：返回一个Connection实例</span><br><span class="hljs-comment">public static void closeResource(Connection c,Statement ps)：关闭资源</span><br><span class="hljs-comment">public static void closeResource(Connection c,Statement ps,ResultSet rs)：关闭资源</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PreparedStatementTest</span></span>&#123;<br>    <span class="hljs-comment">//适用于不同的表的增、删、改操作</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(String sql,Object ... args)</span></span>&#123;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.获取数据库的连接</span><br>            conn = JDBCUtils.getConnection();<br>            <br>            <span class="hljs-comment">//2.获取PreparedStatement的实例 (或：预编译sql语句)</span><br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-comment">//3.填充占位符</span><br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i &lt; args.length;i++)&#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            <span class="hljs-comment">//4.执行sql语句</span><br>            ps.execute();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            <span class="hljs-comment">//5.关闭资源</span><br>            JDBCUtils.closeResource(conn, ps);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>举例2：使用PreparedStatement实现查询操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">prepareStatementTest</span></span>&#123;<br>    <span class="hljs-comment">// 通用的针对于不同表的查询:返回一个对象</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getInstance</span><span class="hljs-params">(Class&lt;T&gt; clazz, String sql, Object... args)</span> </span>&#123;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        ResultSet rs = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 1.获取数据库连接</span><br>            conn = JDBCUtils.getConnection();<br>            <span class="hljs-comment">// 2.预编译sql语句，得到PreparedStatement对象</span><br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-comment">// 3.填充占位符</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            <span class="hljs-comment">// 4.执行executeQuery(),得到结果集：ResultSet</span><br>            rs = ps.executeQuery();<br>            <span class="hljs-comment">// 5.得到结果集的元数据：ResultSetMetaData</span><br>            ResultSetMetaData rsmd = rs.getMetaData();<br>            <span class="hljs-comment">// 6.1通过ResultSetMetaData得到columnCount,columnLabel；通过ResultSet得到列值</span><br>            <span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>            <span class="hljs-keyword">if</span> (rs.next()) &#123;<br>                T t = clazz.newInstance();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<span class="hljs-comment">// 遍历每一个列</span><br>                    <span class="hljs-comment">// 获取列值</span><br>                    Object columnVal = rs.getObject(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-comment">// 获取列的别名:列的别名必须和类的属性相同</span><br>                    String columnLabel = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-comment">// 6.2使用反射，给对象的相应属性赋值</span><br>                    Field field = clazz.getDeclaredField(columnLabel);<br>                    field.setAccessible(<span class="hljs-keyword">true</span>);<br>                    field.set(t, columnVal);<br>                &#125;<br>                <span class="hljs-keyword">return</span> t;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<span class="hljs-comment">// 7.关闭资源</span><br>            JDBCUtils.closeResource(conn, ps, rs);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如果考虑事务操作，则不应该在方法中获取和关闭连接，需要在调用之前传入<code>Connection</code>对象，对于事务的操作可以简化为以下步骤：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testJDBCTransaction</span><span class="hljs-params">()</span> </span>&#123;<br>    Connection conn = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 1.获取数据库连接</span><br>        conn = JDBCUtils.getConnection();<br>        <span class="hljs-comment">// 2.开启事务,关闭自动提交</span><br>        conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br>        <span class="hljs-comment">// 3.进行数据库操作，这里的两个SQL操作组成一个事务</span><br>        String sql1 = <span class="hljs-string">&quot;update user_table set balance = balance - 100 where user = ?&quot;</span>;<br>        update(conn, sql1, <span class="hljs-string">&quot;AA&quot;</span>);  <span class="hljs-comment">//执行事务</span><br>        <span class="hljs-comment">// 模拟网络异常。如果有异常，事务会回滚</span><br>        <span class="hljs-comment">//System.out.println(10 / 0);</span><br><br>        String sql2 = <span class="hljs-string">&quot;update user_table set balance = balance + 100 where user = ?&quot;</span>;<br>        update(conn, sql2, <span class="hljs-string">&quot;BB&quot;</span>);<br>        <span class="hljs-comment">// 4.若没有异常，则提交事务</span><br>        conn.commit();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>        <span class="hljs-comment">// 5.若有异常，则回滚事务</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            conn.rollback();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e1) &#123;<br>            e1.printStackTrace();<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//6.恢复自动提交</span><br>            conn.setAutoCommit(<span class="hljs-keyword">true</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-comment">//7.关闭连接</span><br>        JDBCUtils.closeResource(conn, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>); <br>    &#125;  <br>&#125;<br><br><span class="hljs-comment">//使用事务以后的方法需要改写，将连接对象作为参数传入，其余内容不变</span><br><span class="hljs-comment">//对于查询操作的方法同样如此。</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Connection conn,String sql, Object... args)</span> </span>&#123;<br>    PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        ps = conn.prepareStatement(sql);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>            ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>        &#125;<br>        ps.execute();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        JDBCUtils.closeResource(<span class="hljs-keyword">null</span>, ps);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Connection</code>的对象也可以调用<code>setTransactionIsolation()</code>方法设置事务的隔离级别</p>
<h2 id="3、资源释放"><a href="#3、资源释放" class="headerlink" title="3、资源释放"></a>3、资源释放</h2><p>执行完操作后，必须要释放资源：</p>
<ul>
<li>释放<code>ResultSet</code>， <code>Statement</code>，<code>Connection</code>。</li>
<li>数据库连接（Connection）是非常稀有的资源，用完后必须马上释放，如果Connection不能及时正确的关闭将导致系统宕机。Connection的使用原则是<strong>尽量晚创建，早释放</strong>。</li>
<li>可以在finally中关闭，保证及时其他代码出现异常，资源也一定能被关闭。  </li>
</ul>
<h2 id="4、总结"><a href="#4、总结" class="headerlink" title="4、总结"></a>4、总结</h2><p>JDBC涉及到的两种思想和两种技术：</p>
<ul>
<li><p>两种思想</p>
<ul>
<li>面向接口编程的思想</li>
<li>ORM思想(object relational mapping)<ul>
<li>一个数据表对应一个java类</li>
<li>表中的一条记录对应java类的一个对象</li>
<li>表中的一个字段对应java类的一个属性</li>
</ul>
</li>
</ul>
<blockquote>
<p>SQL查询的结果集中列的别名，必须要和类的属性名相同。</p>
</blockquote>
</li>
<li><p>两种技术</p>
<ul>
<li>JDBC结果集的元数据：<code>ResultSetMetaData</code>，作用为<ul>
<li>获取结果集列数：<code>getColumnCount()</code></li>
<li>获取列的别名：<code>getColumnLabed()</code></li>
</ul>
</li>
<li>通过反射，创建指定类的对象，获取指定的属性并赋值。</li>
</ul>
</li>
</ul>
<h1 id="三、DAO的使用"><a href="#三、DAO的使用" class="headerlink" title="三、DAO的使用"></a>三、DAO的使用</h1><p><strong>DAO（Data Access Object）</strong>：访问数据信息的类和接口，只包括了对数据的CRUD（Create、Retrival、Update、Delete）操作，而不包含任何业务相关的信息。有时也称作：BaseDAO</p>
<p>作用：为了实现功能的模块化，更有利于代码的维护和升级。</p>
<p>使用DAO主要包括三部分：</p>
<ul>
<li>将DAO定义为一个抽象类，包含了CRUD基本操作，适用于所有表。</li>
<li>对每个表，定义一个接口，接口规范了当前表的不同功能。</li>
<li>每个表对应一个实现类，此类继承DAO抽象类，并实现了此表对应的接口。</li>
</ul>
<p>最后，我们只需要调用实现类的方法，满足不同的需求。</p>
<p>比如，对于<code>Customer</code>类，数据库中对应customers表，使用DAO及其相关实现类如下</p>
<p> <code>DAO.java</code>文件类，定义抽象类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * DAO: data(base) access object</span><br><span class="hljs-comment"> * 封装了针对于数据表的通用的操作</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseDAO</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-keyword">private</span> Class&lt;T&gt; clazz = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-comment">//需要获取BaseDAO子类的带泛型父类的泛型，根据此泛型得知要操作的类。</span><br>    <span class="hljs-comment">//可以在代码块或者构造器中获取。</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BaseDAO</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//带泛型的父类，即BaseDAO&lt;Customer&gt;</span><br>        Type genericSuperclass = <span class="hljs-keyword">this</span>.getClass().getGenericSuperclass();<br>        ParameterizedType paramType = (ParameterizedType) genericSuperclass;<br>        <span class="hljs-comment">//获取父类的泛型，即Customer</span><br>        Type[] actualTypeArguments = paramType.getActualTypeArguments();<br>        clazz = (Class&lt;T&gt;) actualTypeArguments[<span class="hljs-number">0</span>];<span class="hljs-comment">//数组的第一个值就是Customer</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// 通用的增删改操作</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(Connection conn, String sql, Object... args)</span> </span>&#123;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 1.预编译sql语句，返回PreparedStatement的实例</span><br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-comment">// 2.填充占位符</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<span class="hljs-comment">// 小心参数声明错误！！</span><br>            &#125;<br>            <span class="hljs-comment">// 3.执行</span><br>            <span class="hljs-keyword">return</span> ps.executeUpdate();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<span class="hljs-comment">// 4.资源的关闭</span><br>            JDBCUtils.closeResource(<span class="hljs-keyword">null</span>, ps);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 通用的查询操作，用于返回数据表中的一条记录</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">getInstance</span><span class="hljs-params">(Connection conn, String sql, Object... args)</span> </span>&#123;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        ResultSet rs = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            rs = ps.executeQuery();<br>            <span class="hljs-comment">// 获取结果集的元数据 :ResultSetMetaData</span><br>            ResultSetMetaData rsmd = rs.getMetaData();<br>            <span class="hljs-comment">// 通过ResultSetMetaData获取结果集中的列数</span><br>            <span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>            <span class="hljs-keyword">if</span> (rs.next()) &#123;<br>                T t = clazz.getConstructor().newInstance();<br>                <span class="hljs-comment">// 处理结果集一行数据中的每一个列</span><br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<br>                    <span class="hljs-comment">// 获取列值</span><br>                    Object columValue = rs.getObject(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-comment">// 获取每个列的列名</span><br>                    String columnLabel = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-comment">// 给t对象指定的columnName属性，赋值为columValue：通过反射</span><br>                    Field field = clazz.getDeclaredField(columnLabel);<br>                    field.setAccessible(<span class="hljs-keyword">true</span>);<br>                    field.set(t, columValue);<br>                &#125;<br>                <span class="hljs-keyword">return</span> t;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtils.closeResource(<span class="hljs-keyword">null</span>, ps, rs);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>    <span class="hljs-comment">// 通用的查询操作，用于返回数据表中的多条记录构成的集合</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;T&gt; <span class="hljs-title">getForList</span><span class="hljs-params">(Connection conn, String sql, Object... args)</span> </span>&#123;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        ResultSet rs = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i++) &#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            rs = ps.executeQuery();<br>            <span class="hljs-comment">// 获取结果集的元数据 :ResultSetMetaData</span><br>            ResultSetMetaData rsmd = rs.getMetaData();<br>            <span class="hljs-comment">// 通过ResultSetMetaData获取结果集中的列数</span><br>            <span class="hljs-keyword">int</span> columnCount = rsmd.getColumnCount();<br>            <span class="hljs-comment">// 创建集合对象</span><br>            ArrayList&lt;T&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;T&gt;();<br>            <span class="hljs-keyword">while</span> (rs.next()) &#123;<br>                T t = clazz.newInstance();<br>                <span class="hljs-comment">// 处理结果集一行数据中的每一个列:给t对象指定的属性赋值</span><br>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; columnCount; i++) &#123;<br>                    <span class="hljs-comment">// 获取列值</span><br>                    Object columValue = rs.getObject(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-comment">// 获取每个列的列名</span><br>                    String columnLabel = rsmd.getColumnLabel(i + <span class="hljs-number">1</span>);<br>                    <span class="hljs-comment">// 给t对象指定的columnName属性，赋值为columValue：通过反射</span><br>                    Field field = clazz.getDeclaredField(columnLabel);<br>                    field.setAccessible(<span class="hljs-keyword">true</span>);<br>                    field.set(t, columValue);<br>                &#125;<br>                list.add(t);<br>            &#125;<br>            <span class="hljs-keyword">return</span> list;<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Exception e) &#123;e.printStackTrace();&#125;<br>        <span class="hljs-keyword">finally</span> &#123;JDBCUtils.closeResource(<span class="hljs-keyword">null</span>, ps, rs);&#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">//用于查询特殊值的通用的方法</span><br>    <span class="hljs-comment">//由于不同列的类型不同，使用泛型方法</span><br>    <span class="hljs-keyword">public</span> &lt;E&gt; <span class="hljs-function">E <span class="hljs-title">getValue</span><span class="hljs-params">(Connection conn,String sql,Object...args)</span></span>&#123;<br>        PreparedStatement ps = <span class="hljs-keyword">null</span>;<br>        ResultSet rs = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ps = conn.prepareStatement(sql);<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;i &lt; args.length;i++)&#123;<br>                ps.setObject(i + <span class="hljs-number">1</span>, args[i]);<br>            &#125;<br>            rs = ps.executeQuery();<br>            <span class="hljs-keyword">if</span>(rs.next())&#123;<br>                <span class="hljs-keyword">return</span> (E) rs.getObject(<span class="hljs-number">1</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            JDBCUtils.closeResource(<span class="hljs-keyword">null</span>, ps, rs);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>CustomerDAO.java</code>文件，定义接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 此接口用于规范针对于customers表的常用操作</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CustomerDAO</span> </span>&#123;<br>    <span class="hljs-comment">//将cust对象添加到数据库中</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Connection conn,Customer cust)</span></span>;<br>    <br>    <span class="hljs-comment">//针对指定的id，删除表中的一条记录</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Connection conn,<span class="hljs-keyword">int</span> id)</span></span>;<br>    <br>    <span class="hljs-comment">//去修改数据表中指定的记录</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Connection conn,Customer cust)</span></span>;<br>    <br>    <span class="hljs-comment">//针对指定的id查询得到对应的Customer对象</span><br>    <span class="hljs-function">Customer <span class="hljs-title">getCustomerById</span><span class="hljs-params">(Connection conn,<span class="hljs-keyword">int</span> id)</span></span>;<br>    <br>    <span class="hljs-comment">//查询表中的所有记录构成的集合</span><br>    <span class="hljs-function">List&lt;Customer&gt; <span class="hljs-title">getAll</span><span class="hljs-params">(Connection conn)</span></span>;<br>    <br>    <span class="hljs-comment">//返回数据表中的数据的条目数</span><br>    <span class="hljs-function">Long <span class="hljs-title">getCount</span><span class="hljs-params">(Connection conn)</span></span>;<br>    <br>    <span class="hljs-comment">//返回数据表中最大的生日</span><br>    <span class="hljs-function">Date <span class="hljs-title">getMaxBirth</span><span class="hljs-params">(Connection conn)</span></span>;<br>&#125;<br><span class="hljs-comment">//可以根据需求，定义不同功能的方法</span><br></code></pre></td></tr></table></figure>
<p><code>CustmoerDAOImpl.java</code>文件，实现接口，继承抽象类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">对于customer表，定义一个实现类，实现接口中的所有方法。</span><br><span class="hljs-comment">实现接口方法时，调用的是DAO抽象类中的方法。</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerDAOImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseDAO</span>&lt;<span class="hljs-title">Customer</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">CustomerDAO</span></span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(Connection conn, Customer cust)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;insert into customers(name,email,birth)values(?,?,?)&quot;</span>;<br>        update(conn, sql,cust.getName(),cust.getEmail(),cust.getBirth());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteById</span><span class="hljs-params">(Connection conn, <span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;delete from customers where id = ?&quot;</span>;<br>        update(conn, sql, id);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Connection conn, Customer cust)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;update customers set name=?,email=?,birth=? where id=?&quot;</span>;<br>        update(conn,sql,cust.getName(),cust.getEmail(),cust.getBirth(),cust.getId());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Customer <span class="hljs-title">getCustomerById</span><span class="hljs-params">(Connection conn, <span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select id,name,email,birth from customers where id = ?&quot;</span>;<br>        Customer customer = getInstance(conn,sql,id);<br>        <span class="hljs-keyword">return</span> customer;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Customer&gt; <span class="hljs-title">getAll</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select id,name,email,birth from customers&quot;</span>;<br>        List&lt;Customer&gt; list = getForList(conn,sql);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">getCount</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select count(*) from customers&quot;</span>;<br>        <span class="hljs-keyword">return</span> getValue(conn, sql);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getMaxBirth</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<br>        String sql = <span class="hljs-string">&quot;select max(birth) from customers&quot;</span>;<br>        <span class="hljs-keyword">return</span> getValue(conn, sql);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h1 id="四、数据库连接池"><a href="#四、数据库连接池" class="headerlink" title="四、数据库连接池"></a>四、数据库连接池</h1><h2 id="1、连接池简介"><a href="#1、连接池简介" class="headerlink" title="1、连接池简介"></a>1、连接池简介</h2><p>传统的数据库连接存在的问题：</p>
<ul>
<li>普通的JDBC数据库连接使用 DriverManager 来获取，每次向数据库建立连接的时候都要将 Connection 加载到内存中，再验证用户名和密码。需要数据库连接的时候，就向数据库要求一个，执行完成后再断开连接。这样的方式将会消耗大量的资源和时间。<strong>数据库的连接资源并没有得到很好的重复利用。</strong>若同时有几百人甚至几千人在线，频繁的进行数据库连接操作将占用很多的系统资源，严重的甚至会造成服务器的崩溃。</li>
<li><strong>对于每一次数据库连接，使用完后都得断开。</strong>否则，如果程序出现异常而未能关闭，将会导致数据库系统中的内存泄漏，最终将导致重启数据库。</li>
<li><strong>这种开发不能控制被创建的连接对象数</strong>，系统资源会被毫无顾及的分配出去，如连接过多，也可能导致内存泄漏，服务器崩溃。</li>
</ul>
<p>为了解决以上的问题，可以采用数据库连接池技术：</p>
<ul>
<li><p><strong>数据库连接池的基本思想</strong>：就是为数据库连接建立一个“缓冲池”。预先在缓冲池中放入一定数量的连接，当需要建立数据库连接时，只需从“缓冲池”中取出一个，使用完毕之后再放回去。</p>
</li>
<li><p><strong>数据库连接池</strong>负责分配、管理和释放数据库连接，它<strong>允许应用程序重复使用一个现有的数据库连接，而不是重新建立一个</strong>。</p>
</li>
<li>数据库连接池在<strong>初始化</strong>时将创建一定数量的数据库连接放到连接池中，这些数据库连接的数量是由<strong>最小数据库连接数来设定</strong>的。无论这些数据库连接是否被使用，连接池都将一直保证至少拥有这么多的连接数量。连接池的<strong>最大数据库连接数量</strong>限定了这个连接池能占有的最大连接数，当应用程序向连接池请求的连接数超过最大连接数量时，这些请求将被加入到等待队列中。</li>
</ul>
<p>数据库连接池的优点：</p>
<ul>
<li><strong>资源重用</strong>。由于数据库连接得以重用，避免了频繁创建和释放连接引起的大量性能开销。在减少系统消耗的基础上，另一方面也增加了系统运行环境的平稳性。</li>
<li><strong>更快的系统反应速度</strong>。数据库连接池在初始化过程中，往往已经创建了若干数据库连接置于连接池中备用。此时连接的初始化工作均已完成。对于业务请求处理而言，直接利用现有可用连接，避免了数据库连接初始化和释放过程的时间开销，从而减少了系统的响应时间</li>
<li><strong>新的资源分配手段，控制每个应用的最大连接数</strong>。对于多应用共享同一数据库的系统而言，可在应用层通过数据库连接池的配置，实现某一应用最大可用数据库连接数的限制，避免某一应用独占所有的数据库资源</li>
<li><strong>统一的连接管理，避免数据库连接泄漏</strong>。在较为完善的数据库连接池实现中，可根据预先的占用超时设定，强制回收被占用连接，从而避免了常规数据库连接操作中可能出现的资源泄露</li>
</ul>
<p>JDBC 的数据库连接池使用<code>javax.sql.DataSource</code> 来表示，<code>DataSource</code> 只是一个接口，该接口通常由服务器(Weblogic, WebSphere, Tomcat)提供实现，也有一些开源组织提供实现：</p>
<ul>
<li><strong>DBCP</strong> 是Apache提供的数据库连接池。tomcat 服务器自带dbcp数据库连接池。<strong>速度相对c3p0较快</strong>，但因自身存在BUG，Hibernate3已不再提供支持。</li>
<li><strong>C3P0</strong> 是一个开源组织提供的一个数据库连接池，<strong>速度相对较慢，稳定性还可以。</strong>hibernate官方推荐使用</li>
<li><strong>Proxool</strong> 是sourceforge下的一个开源项目数据库连接池，有监控连接池状态的功能，<strong>稳定性较c3p0差一点</strong></li>
<li><strong>BoneCP</strong> 是一个开源组织提供的数据库连接池，速度快</li>
<li><strong>Druid</strong> 是阿里提供的数据库连接池，据说是集DBCP 、C3P0 、Proxool 优点于一身的数据库连接池，但是速度不确定是否有BoneCP快</li>
</ul>
<p><code>DataSource</code> 通常被称为数据源，它包含<strong>连接池</strong>和<strong>连接池管理</strong>两个部分，习惯上也经常把<code>DataSource</code> 称为<strong>连接池</strong>。</p>
<ul>
<li><strong>DataSource用来取代DriverManager来获取Connection，获取速度快，同时可以大幅度提高数据库访问速度。</strong></li>
<li><strong>整个应用只需要创建一个数据源（连接池）即可。</strong></li>
<li>当数据库访问结束后，程序还是像以前一样关闭数据库连接：<code>conn.close();</code>但<code>conn.close()</code>操作并没有关闭数据库的物理连接，它仅仅把数据库连接释放，归还给了数据库连接池（由busy状态变为free状态）。</li>
</ul>
<h2 id="2、Druid数据库连接池"><a href="#2、Druid数据库连接池" class="headerlink" title="2、Druid数据库连接池"></a>2、Druid数据库连接池</h2><p>Druid是阿里巴巴开源平台上一个数据库连接池实现，它结合了C3P0、DBCP、Proxool等DB池的优点，同时加入了日志监控，可以很好的监控DB池连接和SQL的执行情况，可以说是针对监控而生的DB连接池，<strong>是目前最好的连接池之一。</strong></p>
<p>连接池的一些配置参数：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left"><strong>配置</strong></th>
<th><strong>缺省</strong></th>
<th style="text-align:left"><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">name</td>
<td></td>
<td style="text-align:left">如果存在多个数据源，监控的时候可以通过名字来区分开来。如果没有配置，将会生成一个名字，格式是：”DataSource-” + System.identityHashCode(this)</td>
</tr>
<tr>
<td style="text-align:left">url</td>
<td></td>
<td style="text-align:left">连接数据库的url，不同数据库不一样。例如：mysql : jdbc:mysql://10.20.153.104:3306/druid2</td>
</tr>
<tr>
<td style="text-align:left">username</td>
<td></td>
<td style="text-align:left">连接数据库的用户名</td>
</tr>
<tr>
<td style="text-align:left">password</td>
<td></td>
<td style="text-align:left">连接数据库的密码。</td>
</tr>
<tr>
<td style="text-align:left">driverClassName</td>
<td></td>
<td style="text-align:left">根据url自动识别   这一项可配可不配，如果不配置druid会根据url自动识别dbType，然后选择相应的driverClassName(建议配置)</td>
</tr>
<tr>
<td style="text-align:left">initialSize</td>
<td>0</td>
<td style="text-align:left">初始化时建立物理连接的个数。初始化发生在显示调用init方法，或者第一次getConnection时</td>
</tr>
<tr>
<td style="text-align:left">maxActive</td>
<td>8</td>
<td style="text-align:left">同时维持的最大连接数</td>
</tr>
<tr>
<td style="text-align:left">maxIdle</td>
<td>8</td>
<td style="text-align:left">最大的空闲连接数。已废弃。类似于JVM中的Xmx</td>
</tr>
<tr>
<td style="text-align:left">minIdle</td>
<td>0</td>
<td style="text-align:left">最小的空闲连接数。类似于JVM中的Xmn</td>
</tr>
<tr>
<td style="text-align:left">minEvictableIdleTimeMillis</td>
<td>1800000L</td>
<td style="text-align:left">池中的空闲连接在一段时间内一直空闲，被逐出连接池的时间</td>
</tr>
<tr>
<td style="text-align:left">maxWait</td>
<td>-1</td>
<td style="text-align:left">获取连接时最大等待时间，单位毫秒。-1表示无限等待。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。</td>
</tr>
<tr>
<td style="text-align:left">poolPreparedStatements</td>
<td>false</td>
<td style="text-align:left">是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle。在mysql下建议关闭。</td>
</tr>
<tr>
<td style="text-align:left">maxOpenPreparedStatements</td>
<td>-1</td>
<td style="text-align:left">开启池的prepared后的同时最大连接数。要启用PSCache，必须配置大于0，当大于0时，poolPreparedStatements自动触发修改为true。在Druid中，不会存在Oracle下PSCache占用内存过多的问题，可以把这个数值配置大一些，比如说100</td>
</tr>
<tr>
<td style="text-align:left">testOnBorrow</td>
<td>true</td>
<td style="text-align:left">申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</td>
</tr>
<tr>
<td style="text-align:left">testOnReturn</td>
<td>false</td>
<td style="text-align:left">归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能</td>
</tr>
<tr>
<td style="text-align:left">testWhileIdle</td>
<td>false</td>
<td style="text-align:left">建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</td>
</tr>
<tr>
<td style="text-align:left">timeBetweenEvictionRunsMillis</td>
<td></td>
<td style="text-align:left">有两个含义： 1)Destroy线程会检测连接的间隔时间2)testWhileIdle的判断依据，详</td>
</tr>
<tr>
<td style="text-align:left">connectionInitSqls</td>
<td></td>
<td style="text-align:left">物理连接初始化的时候执行的sql</td>
</tr>
</tbody>
</table>
</div>
<p>Druid数据库连接池使用案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//只需要创建一个连接池，因此写在静态代码块中</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> DataSource source;<br><span class="hljs-keyword">static</span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Properties pros = <span class="hljs-keyword">new</span> Properties();<br>        FileInputStream is = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">&quot;src/druid.properties&quot;</span>);<br>        pros.load(is);<br>        <span class="hljs-comment">//创建一个druid连接池</span><br>        source = DruidDataSourceFactory.createDataSource(pros);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>    Connection conn = source.getConnection();<br>    <span class="hljs-keyword">return</span> conn;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>其中<code>druid.properties</code>配置文件内容如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql:///test?characterEncoding=utf8</span><br><span class="hljs-attr">username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">abc123</span><br><span class="hljs-attr">driverClassName</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-attr">initialSize</span>=<span class="hljs-string">10</span><br><span class="hljs-attr">maxActive</span>=<span class="hljs-string">10</span><br></code></pre></td></tr></table></figure>
<h1 id="五、Apache-DBUtils工具类"><a href="#五、Apache-DBUtils工具类" class="headerlink" title="五、Apache-DBUtils工具类"></a>五、Apache-DBUtils工具类</h1><p><code>commons-dbutils</code>是 Apache 组织提供的一个开源 JDBC工具类库，它是对JDBC的简单封装，学习成本极低，并且使用<code>dbutils</code>能极大简化jdbc编码的工作量，同时也不会影响程序的性能。</p>
<p>API介绍：</p>
<ul>
<li><code>org.apache.commons.dbutils.QueryRunner</code>该类简单化了SQL查询，与<code>ResultSetHandler</code>搭配使用，可以完成大部分数据库操作。<code>QueryRunner</code>的主要方法有：<ul>
<li>update：执行插入、更新、删除操作</li>
<li>insert：只支持insert语句</li>
<li>query：查询操作</li>
</ul>
</li>
<li><code>org.apache.commons.dbutils.ResultSetHandler</code>该接口用于处理<code>ResultSet</code>，将数据按要求转换为另一种形式。并且提供了一个单独的方法：<code>Object handle (java.sql.ResultSet.rs)</code>。该接口的主要实现类有：<ul>
<li>ArrayHandler：把结果集中的第一行数据转成对象数组。</li>
<li>ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中。</li>
<li><strong>BeanHandler：</strong>将结果集中的第一行数据封装到一个对应的JavaBean实例中。</li>
<li><strong>BeanListHandler：</strong>将结果集中的每一行数据都封装到一个对应的JavaBean实例中，存放到List里。</li>
<li>ColumnListHandler：将结果集中某一列的数据存放到List中。</li>
<li>KeyedHandler(name)：将结果集中的每一行数据都封装到一个Map里，再把这些map再存到一个map里，其key为指定的key。</li>
<li><strong>MapHandler：</strong>将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值。</li>
<li><strong>MapListHandler：</strong>将结果集中的每一行数据都封装到一个Map里，然后再存放到List</li>
<li><strong>ScalarHandler：</strong>查询单个值对象</li>
</ul>
</li>
<li>工具类<code>org.apache.commons.dbutils.DbUtils</code>用于关闭连接、装载JDBC驱动程序等操作。里面的所有方法都是静态的。比如以下方法：<ul>
<li><code>public static void close(xxx) throws java.sql.SQLException</code>，关闭指定的资源。</li>
<li><code>public static void closeQuietly(xxx)</code>: 这一类方法不仅能在Connection、Statement和ResultSet为NULL情况下避免关闭，还能隐藏一些在程序中抛出的SQLEeception。</li>
<li><code>public static void commitAndClose(Connection conn)throws SQLException</code>： 用来提交连接的事务，然后关闭连接</li>
<li><code>public static void commitAndCloseQuietly(Connection conn)</code>： 用来提交连接，然后关闭连接，并且在关闭连接时不抛出SQL异常。 </li>
<li><code>public static void rollback(Connection conn)throws SQLException</code>：允许conn为null，因为方法内部做了判断</li>
<li><code>public static void rollbackAndClose(Connection conn)throws SQLException</code></li>
<li><code>rollbackAndCloseQuietly(Connection)</code></li>
<li><code>public static boolean loadDriver(java.lang.String driverClassName</code>)：这一方装载并注册JDBC驱动程序，如果成功就返回true。使用该方法，不需要捕捉这个异常ClassNotFoundException</li>
</ul>
</li>
</ul>
<p><code>DBUtils</code>的使用案例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dbutilsTest</span></span>&#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    BeanHandler：是ResultSetHandler接口的实现类，用于封装表中的一条记录</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testQuery1</span><span class="hljs-params">()</span></span>&#123;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            conn = JDBCUtils.getConnection();<br>            QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br>            String sql = <span class="hljs-string">&quot;select id,name,email,birth from customers where id=?&quot;</span>;<br>            BeanHandler&lt;Customer&gt; handler = <span class="hljs-keyword">new</span> BeanHandler&lt;&gt;(Customer.class);<br>            Customer query = runner.query(conn, sql, handler, <span class="hljs-number">22</span>);<br>            System.out.println(query);<br>        &#125;<span class="hljs-keyword">catch</span> (SQLException e)&#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtils.closeResource(conn,<span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    MapHandler：是ResultSetHandler接口的实现类，对应表中的一条记录</span><br><span class="hljs-comment">    将字段及字段的值作为map中的key和value</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testQuery3</span><span class="hljs-params">()</span></span>&#123;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            conn = JDBCUtils.getConnection();<br>            QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br>            String sql = <span class="hljs-string">&quot;select id,name,email,birth from customers where id=?&quot;</span>;<br>            MapHandler handler = <span class="hljs-keyword">new</span> MapHandler();<br>            Map&lt;String, Object&gt; query = runner.query(conn, sql, handler, <span class="hljs-number">22</span>);<br>            System.out.println(query);<br>        &#125;<span class="hljs-keyword">catch</span> (SQLException e)&#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtils.closeResource(conn,<span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    ScalarHandler用于查询特殊值</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testQuery5</span><span class="hljs-params">()</span></span>&#123;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            conn = JDBCUtils.getConnection();<br>            QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br>            String sql = <span class="hljs-string">&quot;select Max(birth) from customers&quot;</span>;<br>            ScalarHandler scalarHandler = <span class="hljs-keyword">new</span> ScalarHandler();<br>            <span class="hljs-comment">//返回sql.date类型，转为util.date型</span><br>            Date date = (Date)runner.query(conn, sql, scalarHandler); <br>            System.out.println(date);<br>        &#125;<span class="hljs-keyword">catch</span> (SQLException e)&#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtils.closeResource(conn,<span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    自定义ResultSetHandler实现类</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testQuery7</span><span class="hljs-params">()</span></span>&#123;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            conn = JDBCUtils.getConnection3();<br>            QueryRunner runner = <span class="hljs-keyword">new</span> QueryRunner();<br>            String sql = <span class="hljs-string">&quot;select id,name,email,birth from customers where id=?&quot;</span>;<br>            ResultSetHandler&lt;Customer&gt; handler = <span class="hljs-keyword">new</span> ResultSetHandler&lt;Customer&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-function"><span class="hljs-keyword">public</span> Customer <span class="hljs-title">handle</span><span class="hljs-params">(ResultSet rs)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;自定义结果&quot;</span>;<br>                &#125;<br>            &#125;;<br>            Customer query = runner.query(conn, sql, handler, <span class="hljs-number">23</span>);<span class="hljs-comment">//返回sql.date类型，转为util.date型</span><br>            System.out.println(query);<br>        &#125;<span class="hljs-keyword">catch</span> (SQLException e)&#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtils.closeResource(conn,<span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h1 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h1><h1 id="1、JDBC总结"><a href="#1、JDBC总结" class="headerlink" title="1、JDBC总结"></a>1、JDBC总结</h1><p>至此，回顾使用JDBC编程的几个主要步骤，主要总结为三步：创建连接、CRUD操作、关闭资源。</p>
<p>可以发现，我们使用数据库连接池代替了传统的连接方式，使用DBUtils工具类代替了手动创建Statement对象实现CRUD的操作，和关闭资源的操作。</p>
<p>JDBC的流程可以总结为下（考虑事务）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpdateWithTx</span><span class="hljs-params">()</span> </span>&#123;<br>    Connection conn = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">/*1.获取连接的操作</span><br><span class="hljs-comment">        方式一：手写的连接：JDBCUtils.getConnection();</span><br><span class="hljs-comment">        方式二：使用数据库连接池：C3P0;DBCP;Druid</span><br><span class="hljs-comment">        */</span><br>        <span class="hljs-comment">/*2.对数据表进行CRUD操作</span><br><span class="hljs-comment">        方式一：使用PreparedStatement对象</span><br><span class="hljs-comment">        public void update(Connection conn,String sql,Object ... args)&#123;&#125;</span><br><span class="hljs-comment">        public T getInstance(Connection conn,String sql,Object ... args)&#123;&#125;</span><br><span class="hljs-comment">        方式二：使用dbutils提供的jar包中提供的QueryRunner类</span><br><span class="hljs-comment">        */</span><br>        <span class="hljs-comment">//提交数据</span><br>        conn.commit();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">try</span> &#123;<span class="hljs-comment">//回滚数据</span><br>            conn.rollback();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e1) &#123;e1.printStackTrace();&#125;<br>    &#125;<span class="hljs-keyword">finally</span>&#123;<br>        <span class="hljs-comment">/*3.关闭连接等操作</span><br><span class="hljs-comment">        方式一：JDBCUtils.closeResource();</span><br><span class="hljs-comment">        方式二：使用dbutils中的DbUtils工具类提供的关闭资源的方法</span><br><span class="hljs-comment">        */</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h1 id="2、常见问题总结"><a href="#2、常见问题总结" class="headerlink" title="2、常见问题总结"></a>2、常见问题总结</h1><p>问题1：<strong>数据库连接池工作原理和实现方案?</strong></p>
<ul>
<li>工作原理：JAVA EE服务器启动时会建立一定数量的池连接，并一直维持不少于此数目的池连接(minIdle)。客户端程序需要连接时，池驱动程序会返回一个未使用的池连接，并将其标记为busy状态。如果当前没有空闲连接，池驱动程序就新建一定数量的连接，新建连接的数量有配置参数决定。当使用的池连接调用完成后，池驱动程序将此连接标记为free，其他调用就可以使用这个连接。</li>
<li>实现方案：<strong>连接池使用集合来进行装载，返回的Connection是原始Connection的代理，代理Connection的close方法，当调用close方法时，不是真正关闭物理连接，而是把它代理的Connection对象放回到连接池中，等待下一次重复利用。</strong></li>
</ul>
<hr>
<p>问题2：<strong>JDBC是如何实现Java程序和JDBC驱动的松耦合的？</strong></p>
<p>通过制定接口，数据库厂商来实现。我们只要通过接口调用即可，<strong>所有的操作都是通过JDBC接口完成的</strong>，而驱动只有在通过Class.forName反射机制来加载的时候才会出现。——面向接口编程</p>
<hr>
<p>问题3：<strong>PreparedStatement有什么缺点，如何解决</strong></p>
<p>缺点：不能直接用它来执行in条件语句。</p>
<p>解决方案：</p>
<ul>
<li>分别进行单条查询——性能很差，不推荐。</li>
<li>使用存储过程——这取决于数据库的实现，不是所有数据库都支持。</li>
<li>动态生成PreparedStatement——不能享受PreparedStatement的缓存带来的好处。</li>
<li>在PreparedStatement查询中使用NULL值——如果知道输入变量的最大个数的话，这是个不错的办法，扩展一下还可以支持无限参数。</li>
</ul>
<hr>
<p>问题4：<strong>JDBC的ResultSet是什么 </strong></p>
<ul>
<li>在查询数据库后会返回一个ResultSet，它像是查询结果集的一张数据表。</li>
<li>ResultSet对象维护了一个游标，指向当前的数据行。开始的时候这个游标指向的是第一行。如果调用了ResultSet的next()方法游标会下移一行，如果没有更多的数据了，next()方法会返回false。可以在for循环中用它来遍历数据集。</li>
<li>默认的ResultSet是不能更新的，游标也只能往下移。也就是说只能从第一行到最后一行遍历一遍。不过也可以创建可以回滚或者可更新的ResultSet。</li>
<li>当生成ResultSet的Statement对象要关闭或者重新执行或是获取下一个ResultSet的时候，ResultSet对象也会自动关闭。</li>
<li>可以通过ResultSet的<code>get</code>方法，传入列名或者从1开始的序号来获取列数据。</li>
</ul>
<hr>
<p>问题5：<strong>JDBC的DataSource是什么，有什么好处</strong></p>
<p>DataSource即数据源，它是定义在<code>javax.sql</code>中的一个接口，跟DriverManager相比，它的功能要更强大。DataSource也被称为数据库连接池。除了提供连接外，它还能够管理连接对象，提供如下功能：</p>
<ul>
<li><strong>缓存PreparedStatement以便更快的执行</strong></li>
<li><strong>可以设置连接超时时间</strong></li>
<li><strong>提供日志记录的功能</strong></li>
<li><strong>ResultSet大小的最大阈值设置</strong></li>
<li><strong>通过JNDI的支持，可以为servlet容器提供连接池的功能</strong></li>
</ul>
<hr>
<p>问题6：<strong>JDBC中存在哪些不同类型的锁</strong></p>
<p>从广义上讲，有两种锁机制来防止多个用户同时操作引起的数据损坏。</p>
<ul>
<li><strong>乐观锁</strong>：只有当更新数据的时候才会锁定记录。</li>
<li><strong>悲观锁</strong>：从查询到更新和提交整个过程都会对数据记录进行加锁。</li>
</ul>
<p>更多问题总结参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&amp;mid=2247483745&amp;idx=1&amp;sn=c5e8d9ad63878aa5bc3dcdbb903d8899&amp;chksm=ebd74060dca0c976345e93c1304b1d1d609e804665a3c2c338cbaa6903eee01477ca47c9645b#rd">JDBC面试题都在这里</a></p>

      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>Kangshitao</li>
    <li><strong>本文链接：</strong><a href="http://kangshitao.github.io/2021/04/30/jdbc-datasource/index.html" title="http:&#x2F;&#x2F;kangshitao.github.io&#x2F;2021&#x2F;04&#x2F;30&#x2F;jdbc-datasource&#x2F;index.html">http:&#x2F;&#x2F;kangshitao.github.io&#x2F;2021&#x2F;04&#x2F;30&#x2F;jdbc-datasource&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://cdn.jsdelivr.net/gh/kangshitao/BlogPicture@main/img/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul> 

        
  <nav class="nav">
    <a href="/2021/05/09/method-area-evolution/"><i class="iconfont iconleft"></i>JVM-不同JDK版本中方法区的演变</a>
    <a href="/2021/04/26/mysql-basis/">MySQL数据库基础篇<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
        <section class="comments">
  
    <div class="btn" id="comments-btn">查看评论</div>
  
  
<div id="valine"></div>
<script defer src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
  window.onload = function () {
    var loadValine = function () {
      new Valine({
        el: '#valine',
        app_id: "dVB32zRRBIgKa5WuB56mtboj-gzGzoHsz",
        app_key: "XipU873t8gkSypbwl1HWUARD",
        placeholder: "write comment content...",
        avatar: "mp",
        pageSize: "10",
        lang: "zh-CN",
      });
    }
    if ( true ) {
      $("#comments-btn").on("click", function () {
        $(this).hide();
        loadValine();
		var title1="text=Live and Learn有新评论啦~ --by Valine"
		var SCKEY_Server="SCT21455TskriUeyliOqL6kHLhiCOMmlB"
		var ValineButton=document.getElementsByClassName("vsubmit vbtn")[0];
		function send_valine_Server(){
			var text="desp=";
			var pageurl=document.URL;
			var ptime=new Date();
			var vnick=document.getElementsByClassName("vnick vinput")[0].value;
			var veditor=document.getElementsByClassName("veditor vinput")[0].value;
			var data=text+"|昵称"+"|评论内容"+"|跳转链接"+"|评论时间"+"\n"+"|----|----|----|----|"+"\n"+"|"+vnick+"|"+veditor+"|"+pageurl+"|" +ptime.toLocaleString()+"|";
			var httpRequest = new XMLHttpRequest();//第一步：创建需要的对象
			httpRequest.open('POST', 'https://sctapi.ftqq.com/'+SCKEY_Server+'.send', true); //第二步：打开连接
			httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");//设置请求头 注：post方式必须设置请求头（在建立连接后设置请求头）
			httpRequest.send(title1+"&"+data);//发送请求 将请头体体写在send中
		};
		ValineButton.onclick=send_valine_Server;
      });
    } else {
      loadValine();
    }
  };
 
</script>


</section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-text">一、传统数据库连接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81JDBC%E7%AE%80%E4%BB%8B"><span class="toc-text">1、JDBC简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-text">2、数据库连接</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8PreparedStatement%E5%AE%9E%E7%8E%B0CRUD%E6%93%8D%E4%BD%9C"><span class="toc-text">二、使用PreparedStatement实现CRUD操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81PreparedStatement%E4%BB%8B%E7%BB%8D"><span class="toc-text">1、PreparedStatement介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81PreparedStatement%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2、PreparedStatement的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%B5%84%E6%BA%90%E9%87%8A%E6%94%BE"><span class="toc-text">3、资源释放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">4、总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81DAO%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">三、DAO的使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-text">四、数据库连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%AE%80%E4%BB%8B"><span class="toc-text">1、连接池简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Druid%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-text">2、Druid数据库连接池</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81Apache-DBUtils%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">五、Apache-DBUtils工具类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">六、总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81JDBC%E6%80%BB%E7%BB%93"><span class="toc-text">1、JDBC总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="toc-text">2、常见问题总结</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=1574716653 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://github.com/kangshitao "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#24292E'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:1574716653@qq.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">Total:
  <span id="busuanzi_value_site_pv" style="font-size:12px;"></span></span>
  <span id="busuanzi_container_site_uv" >| Visitors:
  <span id="busuanzi_value_site_uv" style="font-size:12px;"></span></span>
  </div>
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
    <div class="search">
  <div class="search-container">
    <div class="search-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <div class="search-input-wrapper">
      <i class="search-input-icon iconfont iconsearch"></i>
      <input class="search-input" type="search" id="search-input" placeholder="Search..." autofocus autocomplete="off"
        autocorrect="off" autocapitalize="off">
    </div>
    <div class="search-output" id="search-output"></div>
  </div>
</div>
  
  
  
<script src="/js/clicklove.js"></script>
<!-- 页面点击小红心 -->
  
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>



  <script>
  $.getScript("//cdn.jsdelivr.net/npm/leancloud-storage@4.1.0/dist/av-min.js", () => {

    AV.init({
      appId: 'dVB32zRRBIgKa5WuB56mtboj-gzGzoHsz',
      appKey: 'XipU873t8gkSypbwl1HWUARD',
      serverURLs: 'https://leancloud.cn/',
    });

    const showCount = (Counter) => {
      const asyncLimit = new AsyncLimit(2);
      $(".leancloud").each(async (e) => {
        const url = $(".leancloud").eq(e).attr('id').trim();
        const query = new AV.Query("Counter");
        query.equalTo("words", url);
        let count = await asyncLimit.run(() => query.count());
        $(".leancloud").eq(e).text(count ? count : '--');
      });
    }

    const addCount = (Counter) => {
      const url = $(".leancloud").length === 1 ? $(".leancloud").attr('id').trim() : 'http://kangshitao.github.io';
      var query = new Counter;
      query.save({
        words: url
      });
    }

    $(function () {
	  const Counter = AV.Object.extend("Counter");
	  showCount(Counter);
      const localhost = /http\:\/\/localhost|http\:\/\/127.0.0.1|http\:\/\/0.0.0.0/;
      if (localhost.test(document.URL)) {
	    return;
	  }
	  addCount(Counter);
    });
  });
</script>





  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>







  <script>
    window.ga = window.ga || function () {
      (ga.q = ga.q || []).push(arguments)
    };
    ga.l = +new Date;
    ga('create', 'G-0FZTGJZNYS', 'auto');
    ga('send', 'pageview');
  </script>
  <script defer src='https://www.google-analytics.com/analytics.js'></script>







</html>